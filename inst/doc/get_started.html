<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Get Started with airGRdatassim</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Get Started with airGRdatassim</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="scope" class="section level2">
<h2>Scope</h2>
<p>Discharge simulations are affected by several sources of uncertainty
(e.g. errors in meteorological forcings, sub-optimal parameter
estimates).</p>
<p>Data assimilation (DA) allows to combine measurements and model
simulations under the assumption that both supply useful information to
obtain the most likely estimate of the system state. Among the
sequential methods, the ensemble-based techniques allow to explicitly
handle different sources of uncertainty and to quantify the unknown
errors of both model states and observations.</p>
<p>After the study of <span class="citation">Piazzi et al.
(2021)</span>, airGRdatassim package <span class="citation">(Piazzi and
Delaigue 2025)</span> provides functions allowing to perform DA-based
ensemble discharge simulations. airGRdatassim is a package based on the
<a href="https://CRAN.R-project.org/package=airGR">airGR</a>
hydrological modeling package <span class="citation">(Coron et al. 2017,
2023)</span>. This package is designed to flexibly use the Ensemble
Kalman filter (EnKF) or Particle filter (PF) technique to assimilate
daily discharge observations into GR4J, GR5J, and GR6J models (use the
command <code>?airGR</code> to get the references of the GR models).</p>
<p>The uncertainty in both the meteorological forcings
(i.e. precipitation and potential evapotranspiration) and model states
(i.e. production store level, routing store level and unit hydrographs)
can be easily taken into account by enabling specific perturbation
procedures.</p>
<p>In this user guide we go through the assimilation procedure with the
aim of explaining how to perform DA-based discharge simulations. Along
with the description of the modelling system, key recommendations are
provided to support the definition of the operational configuration.</p>
</div>
<div id="loading-catchment-data" class="section level2">
<h2>Loading catchment data</h2>
<p>airGRdatassim is a package based on the <a href="https://CRAN.R-project.org/package=airGR">airGR</a> hydrological
modeling package <span class="citation">(Coron et al. 2017,
2023)</span>.</p>
<p>All the examples rely on the following data set, which is available
in <a href="https://CRAN.R-project.org/package=airGR">airGR</a>
package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(airGRdatassim)</span></code></pre></div>
<pre><code>## Le chargement a nécessité le package : airGR</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">data</span>(L0123001, <span class="at">package =</span> <span class="st">&quot;airGR&quot;</span>) </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">head</span>(BasinObs)</span></code></pre></div>
<pre><code>##       DatesR    P    T   E   Qls    Qmm
## 1 1984-01-01  4.1  0.5 0.2  2640 0.6336
## 2 1984-01-02 15.9  0.2 0.2  3440 0.8256
## 3 1984-01-03  0.8  0.9 0.3 12200 2.9280
## 4 1984-01-04  0.0  0.5 0.3  7600 1.8240
## 5 1984-01-05  0.0 -1.6 0.1  6250 1.5000
## 6 1984-01-06  0.0  0.9 0.3  5650 1.3560</code></pre>
</div>
</div>
<div id="settings-for-data-assimilation" class="section level1">
<h1>Settings for data assimilation</h1>
<p>This section introduces and explains the main settings of the DA
scheme that the user needs to define.</p>
<div id="ensemble-size" class="section level2">
<h2>Ensemble size</h2>
<p>The ensemble size can be defined by assigning <code>NbMbr</code> with
the number of ensemble members.</p>
<p>It is noteworthy that the PF technique is more sensitive to the
ensemble size than the EnKF scheme. Indeed, compared to the EnKF scheme,
the PF generally needs a larger ensemble size to efficiently perform the
weighting and resampling of particles. It is recommended to generate and
use an ensemble of at least 20 or 30 members, when using the EnKF or the
PF scheme, respectively.</p>
</div>
<div id="enabledisable-the-assimilation-via-enkf-or-pf" class="section level2">
<h2>Enable/disable the assimilation via EnKF or PF</h2>
<p>The DA methodology can be chosen between EnKF and PF by defining
<code>DaMethod</code>. To perform the open-loop simulation (i.e.,
without DA), the assimilation of discharge observations can be
disabled.</p>
<p>If <code>DaMethod = &quot;PF&quot;</code>, the PF performs the joint update of
all the state variables.</p>
<p>If <code>DaMethod = &quot;EnKF&quot;</code>, the EnKF performs the update of
the state variables specified in <code>StateEnKF</code>.</p>
<p>If <code>DaMethod = &quot;none&quot;</code>, discharge assimilation is not
performed (i.e., open-loop simulation).</p>
<p>Among the model states, the update of the routing store level ensures
the most benefit from the assimilation of observed discharges.
Conversely, the update of the unit hydrograph only has a slight impact
on the accuracy of the DA-based discharge simulations <span class="citation">(Piazzi et al. 2021)</span>.</p>
</div>
<div id="model-uncertainties" class="section level2">
<h2>Model uncertainties</h2>
<p>Both the uncetainties in meteorological forcings and state variables
can be taken into account in the assimilation scheme.</p>
<p>For both DA techniques, the state variables defined in
<code>StatePert</code> are perturbed.</p>
<p>The perturbation of model states is performed through a
normally-distributed null-mean noise. The noise variance is assumed
equal to the variance of the state variables resulting from the analysis
procedure and it is restricted between upper and lower limits <span class="citation">(Salamon and Feyen 2009)</span>.</p>
<p>When considering the uncertainty in the forcings, the
<code>CreateInputsPert()</code> function generates an ensemble for
precipitation or/and potential evapotranspiration, provided as function
argument/s. It is noteworthy that a significant reduction in the
ensemble spread may occur especially in no-rain periods, when accounting
only for meteorological uncertainty.</p>
<p>Even though a more comprehensive representation of the state
uncertainty can prevent the ensemble shrinkage, it has a different
impact on the performance of the PF and the EnKF schemes <span class="citation">(Piazzi et al. 2021)</span>. Indeed, while a higher
model error covariance can lead to an overweighting of observations in
the EnKF-based analysis procedure, a larger spread of the ensemble
simulations allows for a more straightforward weighting and thus a more
efficient resampling of particles in the PF scheme.</p>
</div>
<div id="definition-of-da-settings" class="section level2">
<h2>Definition of DA settings</h2>
<p>The example below considers EnKF-based discharge simulations relying
on a 100-member ensemble, when accounting for the uncertainty in model
state variables (see <code>StatePert</code>). More specifically, only
the levels of the production (<code>&quot;Prod&quot;</code>) and the routing
(<code>&quot;Rout&quot;</code>) stores are updated and perturbed (see
<code>StatePert</code>).</p>
<p>It is of key importance to consider that <code>StateEnKF</code>
allows to select the state variables to be updated and
<code>StatePert</code> identifies the state variables to be perturbed in
the EnKF scheme. Conversely, in the PF scheme <code>StatePert</code>
identifies the state variables of interest only within the perturbation
procedure, as this DA technique jointly updates all the model
states.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># ensemble size </span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>NbMbr <span class="ot">&lt;-</span> <span class="dv">100</span><span class="dt">L</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># &quot;EnKF&quot; ; &quot;PF&quot; ; &quot;none&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>DaMethod <span class="ot">&lt;-</span> <span class="st">&quot;EnKF&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co"># &quot;Prod&quot;: production store level</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co"># &quot;Rout&quot;: routing store level;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co"># &quot;UH1&quot;: unit hydrograph 1 levels (not defined in GR5J model)</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co"># &quot;UH2&quot;: unit hydrograph 2 levels</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>StateEnKF <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Prod&quot;</span>, <span class="st">&quot;Rout&quot;</span>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>StatePert <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Prod&quot;</span>, <span class="st">&quot;Rout&quot;</span>) </span></code></pre></div>
</div>
</div>
<div id="ensemble-meteorological-forcings" class="section level1">
<h1>Ensemble meteorological forcings</h1>
<p>When accounting for the uncertainty in meteorological forcings, the
<code>CreateInputsPert()</code> function generates an ensemble for
precipitation or/and potential evapotranspiration, provided as function
argument/s.</p>
<p>Probabilistic model inputs result from the perturbation of the
meteorological data through a multiplicative stochastic noise, according
to the methodology proposed by <span class="citation">Clark et al.
(2008)</span> The random perturbations are provided through a
first-order autoregressive model in order to guarantee a physical
consistency and a temporal correlation of the time-variant forcings. For
the generation of perturbations of both the meteorological variables,
the fractional error parameter is set equal to 0.65 and the temporal
decorrelation length is defined as 1 day for rainfall and 2 days for
potential evapotranspiration, by default.</p>
<p>Deterministic model inputs are still needed for the warm-up period
and they are generated through the <code>CreateInputsModel()</code>
function of the <a href="https://CRAN.R-project.org/package=airGR">airGR</a> package.</p>
<p>In this example, discharge simulations are provided by GR5J model
throughout the period from 2006-09-01 to 2006-09-31.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">## simulation period</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>IndRun <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">which</span>(<span class="fu">format</span>(BasinObs<span class="sc">$</span>DatesR, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="sc">==</span> <span class="st">&quot;2006-09-01&quot;</span>), </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>              <span class="fu">which</span>(<span class="fu">format</span>(BasinObs<span class="sc">$</span>DatesR, <span class="at">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>) <span class="sc">==</span> <span class="st">&quot;2006-10-31&quot;</span>))</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="do">## preparation of InputsModel object</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>InputsModel <span class="ot">&lt;-</span> <span class="fu">CreateInputsModel</span>(<span class="at">FUN_MOD =</span> RunModel_GR5J, <span class="at">DatesR =</span> BasinObs<span class="sc">$</span>DatesR, </span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                                 <span class="at">Precip =</span> BasinObs<span class="sc">$</span>P, <span class="at">PotEvap =</span> BasinObs<span class="sc">$</span>E)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="do">## generation of probabilistic model inputs</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>InputsPert <span class="ot">&lt;-</span> <span class="fu">CreateInputsPert</span>(<span class="at">FUN_MOD =</span> RunModel_GR5J,</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>                               <span class="at">DatesR =</span> BasinObs<span class="sc">$</span>DatesR,</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>                               <span class="at">Precip =</span> BasinObs<span class="sc">$</span>P, <span class="at">PotEvap =</span> BasinObs<span class="sc">$</span>E, </span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>                               <span class="at">NbMbr =</span> NbMbr)</span></code></pre></div>
<p>Please note that if the uncertainty in meteorological forcings is not
taken into account, the same deterministic <code>InputsModel</code>
object is used to force each ensemble member.</p>
</div>
<div id="discharge-observations-for-da" class="section level1">
<h1>Discharge observations for DA</h1>
<p>The estimate of the observation error is of critical importance, as
it defines how the filter trusts the observations and thus to what
extent they are assimilated into the model.</p>
<p>By default, the measurement noise is generated from a normal
distribution with a zero-valued mean and a variance parameterized as a
function of the observed discharge rate <span class="citation">(Weerts
and El Serafy 2006; Clark et al. 2008)</span>. With the aim of
preventing underestimated error variances in case of low discharge, the
minimum threshold of the observation error variance is evaluated as the
quantile 10 of discharge observations, by default <span class="citation">(Thirel et al. 2010)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="do">## discharge observations to be assimilated</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>Qobs <span class="ot">&lt;-</span> BasinObs<span class="sc">$</span>Qmm[IndRun]</span></code></pre></div>
</div>
<div id="da-based-discharge-simulations" class="section level1">
<h1>DA-based discharge simulations</h1>
<p>We assume that the GR5J model has been previously calibrated by using
the <code>Calibration()</code> function of <a href="https://CRAN.R-project.org/package=airGR">airGR</a> package.
Therefore, we refer to the calibrated values of model parameters as
<code>Param</code>.</p>
<p>The <code>RunModel_DA()</code> function supplies the ensemble
discharge simulations resulting from the sequential assimilation of
daily discharge observations via EnKF or PF. Because of the recursive
approach, the analysis states resulting from the assimilation procedure
at time step <code>t</code> are used as initial states at the following
prediction time step <code>t + 1</code>.</p>
<p>If the state uncertainty is taken into account
(<code>StatePert</code>), the initial state at the prediction time step
<code>t + 1</code> is the perturbed analysis state resulting from the
assimilation and perturbation procedures at time step
<code>t</code>.</p>
<p>The function provides three outputs:</p>
<ul>
<li><p>the ensemble discharge simulations
(<code>QsimEns</code>)</p></li>
<li><p>the ensemble values of background model states, namely before the
filter update (<code>EnsStateBkg</code>)</p></li>
<li><p>the ensemble values of analysis model states, namely after the
filter update (<code>EnsStateA</code>)</p></li>
</ul>
<div id="enkf-based-discharge-simulations" class="section level2">
<h2>EnKF-based discharge simulations</h2>
<p>The following example supplies probabilistic discharge simulations
relying on the EnKF-based assimilation of daily discharge
observations.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>Param <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">X1 =</span> <span class="fl">194.243</span>, <span class="at">X2 =</span> <span class="sc">-</span><span class="fl">0.088</span>, <span class="at">X3 =</span> <span class="fl">117.740</span>, <span class="at">X4 =</span> <span class="fl">1.680</span>, <span class="at">X5 =</span> <span class="fl">0.000</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>ResEnKF <span class="ot">&lt;-</span> <span class="fu">RunModel_DA</span>(<span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>                       <span class="at">InputsPert =</span> InputsPert,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>                       <span class="at">Qobs =</span> BasinObs<span class="sc">$</span>Qmm,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>                       <span class="at">IndRun =</span> IndRun,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                       <span class="at">FUN_MOD =</span> RunModel_GR5J, <span class="at">Param =</span> Param,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>                       <span class="at">DaMethod =</span> <span class="st">&quot;EnKF&quot;</span>, <span class="at">NbMbr =</span> NbMbr,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>                       <span class="at">StateEnKF =</span> StateEnKF, <span class="at">StatePert =</span> StatePert)</span></code></pre></div>
<p>As defined in <code>StateEnKF</code>, in this example the EnKF scheme
updates only the levels of the production (<code>&quot;Prod&quot;</code>) and the
routing (<code>&quot;Rout&quot;</code>) stores through the assimilation of
discharge observations. Along with the uncertainty in meterological
forcings (<code>InputsPert</code> is supplied), also the uncertainty in
model states (<code>StatePert</code>) is taken into account. Therefore,
the selected state variables (i.e. the store levels) are consistently
perturbed after their update.</p>
<p>The EnKF scheme relies on mass-constraints to guarantee the
non-negativity of state variables by ensuring minimum state values. It
is noteworthy that the level of production store cannot drop below the 5
percent of its capacity. A further constraint prevents the levels of
both the production and the routing stores from exceeding their maximum
capacities.</p>
</div>
<div id="pf-based-discharge-simulations" class="section level2">
<h2>PF-based discharge simulations</h2>
<p>The example below provides ensemble discharge simulations resulting
from the daily PF-based assimilation of discharge observations.</p>
<p>The PF scheme relies on the Sequential Importance Resampling (SIR)
technique <span class="citation">(Gordon, Salmond, and Smith
1993)</span>. According to the SIR approach, the importance weights
associated to the particles are updated according to the likelihood of
particle states with respect to the observed one. A resampling procedure
allows to discard particles having a low probability and to replicate
those having a high importance weight. If the ensemble is too squeezed
to properly evaluate the importance weights, all particles are assigned
equal weights.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>ResPF <span class="ot">&lt;-</span> <span class="fu">RunModel_DA</span>(<span class="at">InputsModel =</span> InputsModel,</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>                     <span class="at">InputsPert =</span> InputsPert,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                     <span class="at">Qobs =</span> BasinObs<span class="sc">$</span>Qmm,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                     <span class="at">IndRun =</span> IndRun,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>                     <span class="at">FUN_MOD =</span> RunModel_GR5J, <span class="at">Param =</span> Param, </span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                     <span class="at">DaMethod =</span> <span class="st">&quot;PF&quot;</span>, <span class="at">NbMbr =</span> NbMbr,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                     <span class="at">StatePert =</span> <span class="st">&quot;Rout&quot;</span>)</span></code></pre></div>
<p>Unlike the previous example, here only the uncertainty in the level
of the routing store (see <code>StatePert</code>) is taken into account.
Therefore, the routing store level is the only state variable to be
perturbed after the updating procedure.</p>
<p>After the state perturbation, a mass-constraint prevents the levels
of both the production and the routing stores from exceeding their
maximum capacities.</p>
</div>
</div>
<div id="comparative-performance-assessment" class="section level1">
<h1>Comparative performance assessment</h1>
<p>Here the performances of the EnKF- and PF-based modelling systems are
assessed against the open-loop run, which provides discharge simulations
without the assimilation of discharge observations.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>RunOptions <span class="ot">&lt;-</span> <span class="fu">CreateRunOptions</span>(<span class="at">FUN_MOD =</span> RunModel_GR5J,</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                               <span class="at">InputsModel =</span> InputsModel, </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                               <span class="at">IndPeriod_Run =</span> IndRun)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>InputsCritMulti <span class="ot">&lt;-</span> <span class="fu">CreateInputsCrit</span>(<span class="at">FUN_CRIT =</span> <span class="fu">list</span>(ErrorCrit_KGE, ErrorCrit_NSE), </span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>                                    <span class="at">InputsModel =</span> InputsModel, <span class="at">RunOptions =</span> RunOptions,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>                                    <span class="at">Obs =</span> <span class="fu">list</span>(Qobs, Qobs),</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>                                    <span class="at">VarObs =</span> <span class="fu">list</span>(<span class="st">&quot;Q&quot;</span>, <span class="st">&quot;Q&quot;</span>), </span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>                                    <span class="at">transfo =</span> <span class="fu">list</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;sqrt&quot;</span>),</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>                                    <span class="at">Weights =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># open-loop run (without DA)</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>OutputsModel_OL <span class="ot">&lt;-</span> <span class="fu">RunModel_GR5J</span>(<span class="at">InputsModel =</span> InputsModel, <span class="at">RunOptions =</span> RunOptions, </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>                                 <span class="at">Param =</span> Param)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>CritOL <span class="ot">&lt;-</span> <span class="fu">ErrorCrit</span>(<span class="at">InputsCrit =</span> InputsCritMulti, <span class="at">OutputsModel =</span> OutputsModel_OL)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># EnKF run</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>OutputsModel_EnKF <span class="ot">&lt;-</span> OutputsModel_OL</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>OutputsModel_EnKF<span class="sc">$</span>Qsim <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(ResEnKF<span class="sc">$</span>QsimEns)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>CritEnKF <span class="ot">&lt;-</span> <span class="fu">ErrorCrit</span>(<span class="at">InputsCrit =</span> InputsCritMulti, <span class="at">OutputsModel =</span> OutputsModel_EnKF)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># PF run</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>OutputsModel_PF <span class="ot">&lt;-</span> OutputsModel_OL</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>OutputsModel_PF<span class="sc">$</span>Qsim <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(ResPF<span class="sc">$</span>QsimEns)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>CritPF <span class="ot">&lt;-</span> <span class="fu">ErrorCrit</span>(<span class="at">InputsCrit =</span> InputsCritMulti, <span class="at">OutputsModel =</span> OutputsModel_PF)</span></code></pre></div>
<p>When comparing the performance of these 3 modelling configurations,
it is noteworthy that the assimilation of discharge observations
generally succeeds in enhancing the accuracy of discharge simulations,
though they rely on different DA settings (i.e. different DA techniques,
system uncertainties and updated states).</p>
<pre><code>##   Method KGE[Q] NSE[sqrt(Q)]
## 1     OL  0.747        0.771
## 2   EnKF  0.778        0.700
## 3     PF  0.870        0.787</code></pre>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-clark_hydrological_2008" class="csl-entry">
Clark, M. P., D. E. Rupp, R. A. Woods, X. Zheng, R. P. Ibbitt, A. G.
Slater, J. Schmidt, and M. J. Uddstrom. 2008. <span>“Hydrological Data
Assimilation with the Ensemble <span>Kalman</span> Filter:
<span>Use</span> of Streamflow Observations to Update States in a
Distributed Hydrological Model.”</span> <em>Advances in Water
Resources</em> 31 (10): 1309–24. <a href="https://doi.org/10.1016/j.advwatres.2008.06.005">https://doi.org/10.1016/j.advwatres.2008.06.005</a>.
</div>
<div id="ref-R-airGR" class="csl-entry">
Coron, L., O. Delaigue, G. Thirel, D. Dorchies, C. Perrin, and C.
Michel. 2023. <em><span class="nocase">airGR</span>: Suite of
<span>GR</span> Hydrological Models for Precipitation-Runoff
Modelling</em>. <em>R News</em>. <a href="https://doi.org/10.15454/EX11NA">https://doi.org/10.15454/EX11NA</a>.
</div>
<div id="ref-airGR2017" class="csl-entry">
Coron, L., G. Thirel, O. Delaigue, C. Perrin, and V. Andréassian. 2017.
<span>“The Suite of Lumped <span>GR</span> Hydrological Models in an
<span>R</span> Package.”</span> <em>Environmental Modelling and
Software</em> 94: 166–71. <a href="https://doi.org/10.1016/j.envsoft.2017.05.002">https://doi.org/10.1016/j.envsoft.2017.05.002</a>.
</div>
<div id="ref-gordon_novel_1993" class="csl-entry">
Gordon, N. J., D. J. Salmond, and A. F. M. Smith. 1993. <span>“Novel
Approach to Nonlinear/Non-<span>Gaussian</span> <span>Bayesian</span>
State Estimation.”</span> <em>IEE Proceedings F - Radar and Signal
Processing</em> 140 (2): 107–13. <a href="https://doi.org/10.1049/ip-f-2.1993.0015">https://doi.org/10.1049/ip-f-2.1993.0015</a>.
</div>
<div id="ref-R-airGRdatassim" class="csl-entry">
Piazzi, G., and O. Delaigue. 2025. <em><span class="nocase">airGRdatassim</span>: Ensemble-Based Data Assimilation in
<span>GR</span> Hydrological Models</em>. <em>R News</em>. <a href="https://doi.org/10.32614/CRAN.package.airGRdatassim">https://doi.org/10.32614/CRAN.package.airGRdatassim</a>.
</div>
<div id="ref-piazzi_sequential_2021" class="csl-entry">
Piazzi, G., G. Thirel, C. Perrin, and O. Delaigue. 2021.
<span>“Sequential Data Assimilation for Streamflow Forecasting:
Assessing the Sensitivity to Uncertinties and to Updated Variables of a
Conceptual Hydrological Model at Basin Scale.”</span> <em>Water
Resources Research</em> 57 (4). <a href="https://doi.org/10.1029/2020WR028390">https://doi.org/10.1029/2020WR028390</a>.
</div>
<div id="ref-salamon_assessing_2009" class="csl-entry">
Salamon, P., and L. Feyen. 2009. <span>“Assessing Parameter,
Precipitation, and Predictive Uncertainty in a Distributed Hydrological
Model Using Sequential Data Assimilation with the Particle
Filter.”</span> <em>Journal of Hydrology</em> 376 (3): 428–42.
https://doi.org/<a href="https://doi.org/10.1016/j.jhydrol.2009.07.051">https://doi.org/10.1016/j.jhydrol.2009.07.051</a>.
</div>
<div id="ref-thirel_past_2010" class="csl-entry">
Thirel, G., E. Martin, J.-F. Mahfouf, S. Massart, S. Ricci, and F.
Habets. 2010. <span>“A Past Discharges Assimilation System for Ensemble
Streamflow Forecasts over <span>France</span> – <span>Part</span> 1:
<span>Description</span> and Validation of the Assimilation
System.”</span> <em>Hydrology and Earth System Sciences</em> 14 (8):
1623–37. <a href="https://doi.org/10.5194/hess-14-1623-2010">https://doi.org/10.5194/hess-14-1623-2010</a>.
</div>
<div id="ref-weerts_particle_2006" class="csl-entry">
Weerts, A. H., and G. Y. H. El Serafy. 2006. <span>“Particle Filtering
and Ensemble <span>Kalman</span> Filtering for State Updating with
Hydrological Conceptual Rainfall-Runoff Models.”</span> <em>Water
Resources Research</em> 42 (9). <a href="https://doi.org/10.1029/2005WR004093">https://doi.org/10.1029/2005WR004093</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
